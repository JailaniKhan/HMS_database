# Supervisor configuration for HMS Queue Processing
# Install this file to /etc/supervisor/conf.d/hms-queues.conf
# Then run: supervisorctl reread && supervisorctl update

[program:hms-queue-worker]
process_name=%(program_name)s_%(process_num)02d
command=php /path/to/your/hms/project/artisan queue:work --queue=reports,default --sleep=3 --tries=3 --max-jobs=1000 --timeout=300
directory=/path/to/your/hms/project
user=www-data
numprocs=2
priority=999
autostart=true
autorestart=true
startsecs=5
startretries=3
redirect_stderr=true
stdout_logfile=/path/to/your/hms/project/storage/logs/supervisor-queue.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=3

[program:hms-queue-worker-high-priority]
process_name=%(program_name)s_%(process_num)02d
command=php /path/to/your/hms/project/artisan queue:work --queue=high,urgent --sleep=1 --tries=5 --max-jobs=500 --timeout=600
directory=/path/to/your/hms/project
user=www-data
numprocs=1
priority=998
autostart=true
autorestart=true
startsecs=5
startretries=3
redirect_stderr=true
stdout_logfile=/path/to/your/hms/project/storage/logs/supervisor-high-priority-queue.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=3

[program:hms-cache-warmer]
process_name=%(program_name)s
command=php /path/to/your/hms/project/artisan cache:warmup
directory=/path/to/your/hms/project
user=www-data
numprocs=1
priority=1000
autostart=false
autorestart=false
startsecs=5
startretries=1
redirect_stderr=true
stdout_logfile=/path/to/your/hms/project/storage/logs/supervisor-cache.log

[group:hms-workers]
programs=hms-queue-worker,hms-queue-worker-high-priority
priority=999

# Monitoring group
[group:hms-monitoring]
programs=hms-cache-warmer
priority=1000